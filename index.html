<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1"/>
  <title>Nitya Seva â€” ISKCON Centre Orai</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <script src="https://www.paynimo.com/paynimocheckout/client/lib/jquery.min.js"></script>
  <script src="https://www.paynimo.com/paynimocheckout/server/lib/checkout.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --saffron:   #E8762B;
      --saffron-d: #C4581A;
      --saffron-l: #FDF0E6;
      --gold:      #C9922A;
      --gold-l:    #FBF3E0;
      --cream:     #FDFAF4;
      --ink:       #1C1608;
      --muted:     #7A6A50;
      --border:    #E8DFC8;
      --white:     #FFFFFF;
      --success:   #2D6A3F;
      --success-l: #E8F5ED;
      --r: 12px;
      --shadow: 0 8px 40px rgba(28,22,8,0.10);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Jost', sans-serif;
      background: var(--cream);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 16px 80px;
      position: relative;
      overflow-x: hidden;
    }

    /* â”€â”€ Decorative top band â”€â”€ */
    .top-band {
      width: 100%;
      background: linear-gradient(135deg, #1C1608 0%, #3A2A08 50%, #1C1608 100%);
      padding: 10px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 0;
    }
    .top-band span {
      color: var(--gold);
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .lotus { font-size: 16px; }

    /* â”€â”€ Hero header â”€â”€ */
    .hero {
      text-align: center;
      padding: 44px 20px 36px;
      max-width: 560px;
      animation: fadeUp 0.7s ease both;
    }

    /* ISKCON emblem SVG placeholder */
    .emblem {
      width: 80px; height: 80px;
      margin: 0 auto 20px;
      display: flex; align-items: center; justify-content: center;
    }
    .emblem svg { width: 100%; height: 100%; }

    .org-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 10px;
    }
    .hero h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(36px, 6vw, 56px);
      font-weight: 400;
      line-height: 1.1;
      color: var(--ink);
      margin-bottom: 14px;
    }
    .hero h1 em { color: var(--saffron); font-style: italic; }
    .hero p {
      font-size: 15px;
      color: var(--muted);
      line-height: 1.7;
      max-width: 380px;
      margin: 0 auto;
      font-weight: 300;
    }

    /* â”€â”€ Decorative divider â”€â”€ */
    .ornament {
      display: flex; align-items: center; gap: 12px;
      color: var(--gold);
      font-size: 18px;
      margin: 8px auto 32px;
      width: fit-content;
    }
    .ornament::before, .ornament::after {
      content: '';
      display: block;
      width: 60px; height: 1px;
      background: linear-gradient(to right, transparent, var(--gold));
    }
    .ornament::after { background: linear-gradient(to left, transparent, var(--gold)); }

    /* â”€â”€ Step pills â”€â”€ */
    .steps {
      display: flex; align-items: center;
      gap: 0;
      margin-bottom: 28px;
      animation: fadeUp 0.7s 0.1s ease both;
      opacity: 0;
      animation-fill-mode: both;
    }
    .step-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .step-dot {
      width: 34px; height: 34px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 600;
      background: var(--border); color: var(--muted);
      transition: all 0.35s ease;
      border: 2px solid transparent;
    }
    .step-dot.active {
      background: var(--saffron); color: white;
      border-color: var(--saffron-d);
      box-shadow: 0 0 0 4px rgba(232,118,43,0.18);
    }
    .step-dot.done { background: var(--success); color: white; border-color: var(--success); }
    .step-label {
      font-size: 9px; font-weight: 600; letter-spacing: 0.8px;
      text-transform: uppercase; color: var(--muted);
      transition: color 0.3s;
    }
    .step-label.active { color: var(--saffron); }
    .step-conn {
      width: 48px; height: 1.5px;
      background: var(--border);
      margin: 0 4px 20px;
      transition: background 0.4s;
    }
    .step-conn.done { background: var(--success); }

    /* â”€â”€ Card â”€â”€ */
    .card {
      background: var(--white);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      padding: 40px 36px;
      width: 100%; max-width: 500px;
      animation: fadeUp 0.7s 0.15s ease both;
      opacity: 0;
      animation-fill-mode: both;
    }

    .card-eyebrow {
      font-size: 10px; font-weight: 600; letter-spacing: 2px;
      text-transform: uppercase; color: var(--saffron);
      margin-bottom: 6px;
    }
    .card-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 26px; font-weight: 600;
      color: var(--ink); margin-bottom: 5px;
    }
    .card-sub {
      font-size: 13px; color: var(--muted);
      margin-bottom: 28px; line-height: 1.6; font-weight: 300;
    }

    /* â”€â”€ Form elements â”€â”€ */
    .form-group { margin-bottom: 18px; }
    .form-group label {
      display: block; font-size: 11px; font-weight: 600;
      letter-spacing: 0.8px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 7px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-family: 'Jost', sans-serif;
      font-size: 15px; color: var(--ink);
      background: var(--cream);
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      outline: none; appearance: none;
    }
    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--saffron);
      background: var(--white);
      box-shadow: 0 0 0 3px rgba(232,118,43,0.12);
    }
    .form-group input.err { border-color: #c0392b; }
    .ferr { font-size: 11px; color: #c0392b; margin-top: 4px; display: none; }
    .ferr.show { display: block; }

    /* Phone */
    .ph-wrap {
      display: flex; border: 1.5px solid var(--border);
      border-radius: 8px; overflow: hidden;
      background: var(--cream);
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .ph-wrap:focus-within {
      border-color: var(--saffron); background: var(--white);
      box-shadow: 0 0 0 3px rgba(232,118,43,0.12);
    }
    .ph-wrap.err { border-color: #c0392b; }
    .ph-pfx {
      display: flex; align-items: center; gap: 5px;
      padding: 12px 14px;
      background: var(--gold-l);
      border-right: 1.5px solid var(--border);
      font-size: 14px; color: var(--muted); font-weight: 500;
      white-space: nowrap; flex-shrink: 0;
    }
    .ph-wrap input {
      border: none !important; box-shadow: none !important;
      border-radius: 0 !important; background: transparent !important;
      flex: 1;
    }
    .ph-wrap input:focus { border: none; box-shadow: none; }

    /* Amount presets */
    .amount-presets {
      display: flex; flex-wrap: wrap; gap: 8px;
      margin-bottom: 10px;
    }
    .preset-btn {
      padding: 6px 14px;
      border: 1.5px solid var(--border);
      border-radius: 100px;
      font-family: 'Jost', sans-serif;
      font-size: 13px; font-weight: 500;
      color: var(--muted); background: var(--cream);
      cursor: pointer; transition: all 0.2s;
    }
    .preset-btn:hover { border-color: var(--saffron); color: var(--saffron); }
    .preset-btn.selected {
      background: var(--saffron); color: white;
      border-color: var(--saffron-d);
    }

    /* Row */
    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

    /* Info box */
    .info-box {
      background: var(--gold-l);
      border: 1px solid #E8D5A0;
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 12.5px; color: #7A5C20;
      line-height: 1.6; margin-bottom: 22px;
      display: flex; gap: 9px; align-items: flex-start;
    }
    .info-box svg { flex-shrink: 0; margin-top: 2px; }

    /* Summary */
    .summary-box {
      background: var(--cream);
      border: 1.5px solid var(--border);
      border-radius: 10px;
      padding: 18px 20px;
      margin-bottom: 22px;
    }
    .summary-title {
      font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
      text-transform: uppercase; color: var(--gold);
      margin-bottom: 14px;
    }
    .sum-row {
      display: flex; justify-content: space-between;
      font-size: 13px; padding: 7px 0;
      border-bottom: 1px solid var(--border);
    }
    .sum-row:last-child { border-bottom: none; }
    .sum-row .k { color: var(--muted); font-weight: 300; }
    .sum-row .v { font-weight: 500; }

    /* Button */
    .btn {
      display: flex; align-items: center; justify-content: center; gap: 9px;
      width: 100%; padding: 15px 24px;
      border: none; border-radius: 8px;
      font-family: 'Jost', sans-serif;
      font-size: 15px; font-weight: 600;
      cursor: pointer; transition: all 0.2s ease;
      letter-spacing: 0.3px;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--saffron) 0%, var(--saffron-d) 100%);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(232,118,43,0.35);
    }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1.5px solid var(--border);
      margin-top: 10px; font-size: 13px;
    }
    .btn-ghost:hover { border-color: var(--muted); color: var(--ink); }

    /* Spinner */
    .spin {
      width: 17px; height: 17px;
      border: 2px solid rgba(255,255,255,0.4);
      border-top-color: white; border-radius: 50%;
      animation: spinning 0.6s linear infinite;
      display: none;
    }

    /* Trust row */
    .trust {
      display: flex; align-items: center; justify-content: center;
      gap: 18px; flex-wrap: wrap; margin-top: 20px;
    }
    .trust-item {
      display: flex; align-items: center; gap: 5px;
      font-size: 11px; color: var(--muted); font-weight: 500;
    }

    /* Result screens */
    .result { text-align: center; padding: 10px 0 16px; }
    .result-icon {
      width: 76px; height: 76px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 22px;
      animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
    }
    .r-success { background: var(--success-l); }
    .r-pending { background: #FFF8E1; }
    .r-error   { background: #FDEDEB; }
    .result h2 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 30px; font-weight: 600; margin-bottom: 10px;
    }
    .result p { font-size: 14px; color: var(--muted); line-height: 1.7; font-weight: 300; }
    .mandate-pill {
      display: inline-block;
      background: var(--saffron-l); color: var(--saffron-d);
      font-size: 12px; font-weight: 600; letter-spacing: 1px;
      padding: 6px 18px; border-radius: 100px; margin: 16px 0;
    }
    .checklist {
      background: var(--success-l); border-radius: 10px;
      padding: 15px 18px; margin: 18px 0; text-align: left;
    }
    .check-item {
      display: flex; align-items: center; gap: 9px;
      font-size: 13px; color: var(--success); padding: 5px 0;
    }

    /* Screens */
    .screen { display: none; }
    .screen.active { display: block; animation: fadeUp 0.35s ease both; }

    /* Footer */
    .footer {
      margin-top: 28px;
      text-align: center;
      font-size: 11px; color: var(--muted);
      animation: fadeUp 0.7s 0.3s ease both; opacity: 0;
      animation-fill-mode: both;
    }
    .footer a { color: var(--saffron); text-decoration: none; }

    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.5); }
      to   { opacity: 1; transform: scale(1); }
    }
    @keyframes spinning { to { transform: rotate(360deg); } }

    @media (max-width: 540px) {
      .card { padding: 28px 20px; }
      .row2 { grid-template-columns: 1fr; }
      .step-conn { width: 28px; }
    }
  </style>
</head>
<body>

<!-- Top band -->
<div class="top-band">
  <span class="lotus">ğŸª·</span>
  <span>Hare Krishna Â· Hare Krishna Â· Krishna Krishna Â· Hare Hare</span>
  <span class="lotus">ğŸª·</span>
</div>

<!-- Hero -->
<div class="hero">
  <!-- ISKCON-style lotus emblem (SVG) -->
  <div class="emblem">
    <svg viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Outer circle -->
      <circle cx="40" cy="40" r="38" stroke="#C9922A" stroke-width="1.5" stroke-dasharray="4 3"/>
      <!-- Lotus petals -->
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#E8762B" opacity="0.85"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#E8762B" opacity="0.85" transform="rotate(45 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#E8762B" opacity="0.85" transform="rotate(90 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#E8762B" opacity="0.85" transform="rotate(135 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#C9922A" opacity="0.7" transform="rotate(22.5 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#C9922A" opacity="0.7" transform="rotate(67.5 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#C9922A" opacity="0.7" transform="rotate(112.5 40 40)"/>
      <ellipse cx="40" cy="22" rx="5" ry="11" fill="#C9922A" opacity="0.7" transform="rotate(157.5 40 40)"/>
      <!-- Centre -->
      <circle cx="40" cy="40" r="10" fill="#FBF3E0" stroke="#C9922A" stroke-width="1.5"/>
      <circle cx="40" cy="40" r="5" fill="#E8762B"/>
    </svg>
  </div>
  <div class="org-name">ISKCON Centre Orai</div>
  <h1>Nitya <em>Seva</em></h1>
  <p>Offer daily service to the Lord through automated giving â€” sacred, secure, and uninterrupted.</p>
</div>

<div class="ornament">ğŸŒ¸</div>

<!-- Step indicators -->
<div class="steps" id="stepIndicators">
  <div class="step-item">
    <div class="step-dot active" id="dot1">1</div>
    <span class="step-label active" id="lbl1">You</span>
  </div>
  <div class="step-conn" id="conn1"></div>
  <div class="step-item">
    <div class="step-dot" id="dot2">2</div>
    <span class="step-label" id="lbl2">Seva</span>
  </div>
  <div class="step-conn" id="conn2"></div>
  <div class="step-item">
    <div class="step-dot" id="dot3">3</div>
    <span class="step-label" id="lbl3">Bank</span>
  </div>
  <div class="step-conn" id="conn3"></div>
  <div class="step-item">
    <div class="step-dot" id="dot4">4</div>
    <span class="step-label" id="lbl4">Done</span>
  </div>
</div>

<!-- â•â• CARD â•â• -->
<div class="card">

  <!-- STEP 1 â€” Personal Details -->
  <div class="screen active" id="s1">
    <div class="card-eyebrow">Step 1 of 3</div>
    <div class="card-title">Your details</div>
    <div class="card-sub">Tell us who you are so we can register your seva correctly.</div>

    <div class="form-group">
      <label>Full Name</label>
      <input type="text" id="fname" placeholder="e.g. Rajesh Kumar" autocomplete="name"/>
      <div class="ferr" id="eName">Please enter your full name</div>
    </div>

    <div class="form-group">
      <label>Mobile Number</label>
      <div class="ph-wrap" id="phWrap">
        <div class="ph-pfx">ğŸ‡®ğŸ‡³ +91</div>
        <input type="tel" id="fmobile" placeholder="9876543210" maxlength="10" inputmode="numeric"/>
      </div>
      <div class="ferr" id="eMobile">Enter a valid 10-digit mobile number</div>
    </div>

    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="femail" placeholder="you@email.com" autocomplete="email"/>
      <div class="ferr" id="eEmail">Please enter a valid email address</div>
    </div>

    <div class="row2">
      <div class="form-group">
        <label>City</label>
        <input type="text" id="fcity" placeholder="Orai"/>
      </div>
      <div class="form-group">
        <label>PAN (optional)</label>
        <input type="text" id="fpan" placeholder="ABCDE1234F" maxlength="10" style="text-transform:uppercase"/>
      </div>
    </div>

    <button class="btn btn-primary" onclick="step1()">
      Continue
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <div class="trust">
      <div class="trust-item">
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none"><path d="M6.5 1L1.5 3.8v3.2C1.5 9.8 3.7 12 6.5 12c2.8 0 5-2.2 5-5V3.8L6.5 1Z" stroke="#7A6A50" stroke-width="1"/></svg>
        256-bit SSL
      </div>
      <div class="trust-item">
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none"><circle cx="6.5" cy="6.5" r="5" stroke="#7A6A50" stroke-width="1"/><path d="M4 6.5l2 2 3.5-3.5" stroke="#7A6A50" stroke-width="1" stroke-linecap="round"/></svg>
        RBI Approved
      </div>
      <div class="trust-item">
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none"><rect x="2" y="5" width="9" height="6.5" rx="1" stroke="#7A6A50" stroke-width="1"/><path d="M4.5 5V3.5a2 2 0 014 0V5" stroke="#7A6A50" stroke-width="1" stroke-linecap="round"/></svg>
        Worldline Secured
      </div>
    </div>
  </div>

  <!-- STEP 2 â€” Seva / Mandate Details -->
  <div class="screen" id="s2">
    <div class="card-eyebrow">Step 2 of 3</div>
    <div class="card-title">Seva details</div>
    <div class="card-sub">Choose how much and how often you'd like to offer.</div>

    <div class="form-group">
      <label>Seva Amount (â‚¹)</label>
      <div class="amount-presets" id="presets">
        <button class="preset-btn" onclick="setPreset(this, 108)">â‚¹108</button>
        <button class="preset-btn" onclick="setPreset(this, 251)">â‚¹251</button>
        <button class="preset-btn" onclick="setPreset(this, 501)">â‚¹501</button>
        <button class="preset-btn" onclick="setPreset(this, 1001)">â‚¹1001</button>
        <button class="preset-btn" onclick="setPreset(this, 0)">Custom</button>
      </div>
      <input type="number" id="famount" placeholder="Enter amount in â‚¹" min="1"/>
      <div class="ferr" id="eAmt">Please enter a valid amount (minimum â‚¹1)</div>
    </div>

    <div class="form-group">
      <label>Frequency</label>
      <select id="ffreq">
        <option value="MNTH">Monthly</option>
        <option value="QURT">Quarterly</option>
        <option value="YEAR">Yearly</option>
        <option value="WEEK">Weekly</option>
        <option value="ADHO">As &amp; when presented</option>
      </select>
    </div>

    <div class="row2">
      <div class="form-group">
        <label>Start Date</label>
        <input type="date" id="fstart"/>
        <div class="ferr" id="eStart">Select a start date</div>
      </div>
      <div class="form-group">
        <label>End Date</label>
        <input type="date" id="fend"/>
        <div class="ferr" id="eEnd">End date must be after start date</div>
      </div>
    </div>

    <div class="form-group">
      <label>Account Type</label>
      <select id="factype">
        <option value="Saving">Savings Account</option>
        <option value="Current">Current Account</option>
      </select>
    </div>

    <div class="info-box">
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="7" r="6" stroke="#C9922A" stroke-width="1.2"/><path d="M7 6v4M7 4.5v.3" stroke="#C9922A" stroke-width="1.2" stroke-linecap="round"/></svg>
      Your bank may debit â‚¹1â€“â‚¹2 as an authentication charge during registration. This amount may be refunded within 2â€“3 working days.
    </div>

    <button class="btn btn-primary" onclick="step2()">
      Review &amp; Proceed
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="btn btn-ghost" onclick="goBack(1)">â† Back</button>
  </div>

  <!-- STEP 3 â€” Confirm & Launch -->
  <div class="screen" id="s3">
    <div class="card-eyebrow">Step 3 of 3</div>
    <div class="card-title">Confirm &amp; authorise</div>
    <div class="card-sub">Review your seva mandate, then verify with your bank.</div>

    <div class="summary-box" id="summaryBox">
      <div class="summary-title">Seva Mandate Summary</div>
    </div>

    <div class="info-box">
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 7h10M8 3l4 4-4 4" stroke="#C9922A" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      A secure Worldline bank window will open. Verify using Net Banking, ATM/Debit Card, or Aadhaar OTP â€” as provided by your bank.
    </div>

    <button class="btn btn-primary" id="btnPay" onclick="launchCheckout()">
      <span id="btnTxt">Authorise with Bank</span>
      <svg id="btnArrow" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div class="spin" id="btnSpin"></div>
    </button>
    <button class="btn btn-ghost" onclick="goBack(2)">â† Back</button>
  </div>

  <!-- SUCCESS -->
  <div class="screen" id="sSuccess">
    <div class="result">
      <div class="result-icon r-success">
        <svg width="38" height="38" viewBox="0 0 38 38" fill="none"><circle cx="19" cy="19" r="18" fill="#2D6A3F" opacity="0.15"/><path d="M11 19l6 6 10-10" stroke="#2D6A3F" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <h2>Hare Krishna! ğŸ™</h2>
      <p>Your Nitya Seva has been registered successfully. The Lord will receive your offering as scheduled.</p>
      <div class="mandate-pill" id="mandatePill">Mandate ID: â€”</div>
      <div class="checklist">
        <div class="check-item">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="7" r="6" fill="#2D6A3F" opacity="0.2"/><path d="M4 7l2 2 4-4" stroke="#2D6A3F" stroke-width="1.3" stroke-linecap="round"/></svg>
          Bank account verified &amp; linked
        </div>
        <div class="check-item">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="7" r="6" fill="#2D6A3F" opacity="0.2"/><path d="M4 7l2 2 4-4" stroke="#2D6A3F" stroke-width="1.3" stroke-linecap="round"/></svg>
          Recurring seva scheduled
        </div>
        <div class="check-item">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="7" r="6" fill="#2D6A3F" opacity="0.2"/><path d="M4 7l2 2 4-4" stroke="#2D6A3F" stroke-width="1.3" stroke-linecap="round"/></svg>
          Confirmation SMS sent to your mobile
        </div>
      </div>
      <p style="font-size:12px;margin-top:4px">You may cancel this mandate anytime via your bank's net banking portal.</p>
    </div>
  </div>

  <!-- PENDING -->
  <div class="screen" id="sPending">
    <div class="result">
      <div class="result-icon r-pending">
        <svg width="38" height="38" viewBox="0 0 38 38" fill="none"><circle cx="19" cy="19" r="18" fill="#F59E0B" opacity="0.15"/><path d="M19 10v9l5 5" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <h2>Registration Initiated</h2>
      <p>Your seva mandate has been submitted and is being processed by your bank. You'll be notified once it's approved (usually within 24â€“48 hours).</p>
      <div class="mandate-pill" id="pendingPill" style="background:#FFF8E1;color:#B45309">Txn Ref: â€”</div>
      <p style="font-size:12px;margin-top:12px;color:var(--muted)">If you don't hear back in 48 hours, please contact us with your transaction reference number.</p>
    </div>
  </div>

  <!-- ERROR -->
  <div class="screen" id="sError">
    <div class="result">
      <div class="result-icon r-error">
        <svg width="38" height="38" viewBox="0 0 38 38" fill="none"><circle cx="19" cy="19" r="18" fill="#E74C3C" opacity="0.12"/><path d="M13 13l12 12M25 13L13 25" stroke="#E74C3C" stroke-width="2" stroke-linecap="round"/></svg>
      </div>
      <h2>Registration Failed</h2>
      <p id="errMsg">The mandate registration could not be completed. This may be due to an authentication issue or a temporary bank error.</p>
      <div style="margin-top:24px">
        <button class="btn btn-primary" onclick="resetAll()">Try Again</button>
      </div>
      <p style="font-size:12px;color:var(--muted);margin-top:14px">Please try again or contact ISKCON Centre Orai for assistance.</p>
    </div>
  </div>

</div><!-- /card -->

<div class="footer">
  Powered by <a href="https://www.worldline.com" target="_blank">Worldline</a> Â· Secured payments Â· ISKCON Centre Orai Â© 2025
</div>

<script>
// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// This points to the secure backend API (on Vercel after deployment).
// During local testing it falls back to computing hash in-browser.
const API_BASE = window.location.hostname === 'localhost' || window.location.protocol === 'file:'
  ? null                        // local: compute hash client-side (testing only)
  : '/api/generate-token';      // production: call secure server

const MERCHANT_ID = 'L1042784';
const SALT_LOCAL  = '9513499579TRJAQP'; // used ONLY for local testing

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let fd = {}; // form data store

// â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const show   = id => { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); };
const fmtDate= d  => { const [y,m,day]=d.split('-'); return `${day}-${m}-${y}`; };
const txnId  = ()  => Date.now().toString();

function setDot(step) {
  for (let i=1;i<=4;i++) {
    const d=document.getElementById('dot'+i), l=document.getElementById('lbl'+i);
    d.classList.remove('active','done'); l.classList.remove('active');
    if(i<step){d.classList.add('done');d.innerHTML='âœ“';}
    else if(i===step){d.classList.add('active');d.innerHTML=i;l.classList.add('active');}
    else{d.innerHTML=i;}
  }
  for(let i=1;i<=3;i++) document.getElementById('conn'+i).classList.toggle('done',i<step);
}

function fe(fid,eid,show_) {
  document.getElementById(fid)?.classList.toggle('err',show_);
  document.getElementById(eid)?.classList.toggle('show',show_);
}
function phErr(s){document.getElementById('phWrap').classList.toggle('err',s);document.getElementById('eMobile').classList.toggle('show',s);}

// â”€â”€ Amount presets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setPreset(btn, val) {
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  const input = document.getElementById('famount');
  if(val === 0) { input.value=''; input.focus(); }
  else { input.value = val; }
}

// â”€â”€ STEP 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function step1() {
  let ok = true;
  const name   = document.getElementById('fname').value.trim();
  const mobile = document.getElementById('fmobile').value.trim();
  const email  = document.getElementById('femail').value.trim();

  if(!name)                      { fe('fname','eName',true); ok=false; } else fe('fname','eName',false);
  if(!/^\d{10}$/.test(mobile))  { phErr(true); ok=false; }             else phErr(false);
  if(!/.+@.+\..+/.test(email))  { fe('femail','eEmail',true); ok=false; } else fe('femail','eEmail',false);
  if(!ok) return;

  fd.name   = name;
  fd.mobile = mobile;
  fd.email  = email;
  fd.city   = document.getElementById('fcity').value.trim();
  fd.pan    = document.getElementById('fpan').value.toUpperCase();

  // Set date defaults before showing step 2
  const today = new Date();
  document.getElementById('fstart').value = today.toISOString().split('T')[0];
  const end = new Date(today); end.setFullYear(end.getFullYear()+10);
  document.getElementById('fend').value = end.toISOString().split('T')[0];

  setDot(2); show('s2');
}

// â”€â”€ STEP 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function step2() {
  let ok = true;
  const amount = document.getElementById('famount').value.trim();
  const start  = document.getElementById('fstart').value;
  const end    = document.getElementById('fend').value;

  if(!amount || isNaN(amount) || parseFloat(amount)<1) { fe('famount','eAmt',true); ok=false; } else fe('famount','eAmt',false);
  if(!start)          { fe('fstart','eStart',true); ok=false; } else fe('fstart','eStart',false);
  if(!end||end<=start){ fe('fend','eEnd',true); ok=false; }     else fe('fend','eEnd',false);
  if(!ok) return;

  fd.amount   = parseFloat(amount).toFixed(2);
  fd.freq     = document.getElementById('ffreq').value;
  fd.start    = fmtDate(start);
  fd.end      = fmtDate(end);
  fd.actype   = document.getElementById('factype').value;
  fd.amtType  = 'M'; // variable â€” user chooses amount

  const freqMap = {DAIL:'Daily',WEEK:'Weekly',MNTH:'Monthly',QURT:'Quarterly',MIAN:'Semi-annually',YEAR:'Yearly',BIMN:'Bi-monthly',ADHO:'As & when presented'};
  const rows = [
    ['Devotee', fd.name],
    ['Mobile',  '+91 ' + fd.mobile],
    ['Email',   fd.email],
    ['Seva Amount', 'â‚¹ ' + parseFloat(fd.amount).toLocaleString('en-IN')],
    ['Frequency', freqMap[fd.freq]],
    ['Debit Start', fd.start],
    ['Debit End',   fd.end],
    ['Account Type', fd.actype],
  ];
  document.getElementById('summaryBox').innerHTML =
    '<div class="summary-title">Seva Mandate Summary</div>' +
    rows.map(([k,v])=>`<div class="sum-row"><span class="k">${k}</span><span class="v">${v}</span></div>`).join('');

  setDot(3); show('s3');
}

// â”€â”€ BACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goBack(to) { setDot(to); show('s'+to); }

// â”€â”€ TOKEN GENERATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function getToken(tid) {
  const consumerId = ('cust_'+fd.mobile).slice(0,20);

  // Production: call secure backend
  if(API_BASE) {
    const resp = await fetch(API_BASE, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        txnId: tid,
        amount: fd.amount,
        consumerId,
        mobileNo: fd.mobile,
        email: fd.email,
        debitStartDate: fd.start,
        debitEndDate:   fd.end,
        maxAmount:      fd.amount,
        amountType:     fd.amtType,
        frequency:      fd.freq
      })
    });
    const data = await resp.json();
    if(!data.token) throw new Error('Token generation failed');
    return { token: data.token, consumerId };
  }

  // Local testing fallback â€” SHA-512 in browser (NOT safe for production)
  const hashStr = [
    MERCHANT_ID, tid, fd.amount, '', consumerId,
    fd.mobile, fd.email, fd.start, fd.end,
    fd.amount, fd.amtType, fd.freq,
    '','','','', SALT_LOCAL
  ].join('|');
  const buf = await crypto.subtle.digest('SHA-512', new TextEncoder().encode(hashStr));
  const token = Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
  return { token, consumerId };
}

// â”€â”€ LAUNCH WORLDLINE CHECKOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function launchCheckout() {
  const btn=document.getElementById('btnPay'),
        txt=document.getElementById('btnTxt'),
        arr=document.getElementById('btnArrow'),
        sp =document.getElementById('btnSpin');

  btn.disabled=true; txt.textContent='Connecting to bankâ€¦'; arr.style.display='none'; sp.style.display='block';

  try {
    const tid = txnId();
    const { token, consumerId } = await getToken(tid);

    const req = {
      features: {
        enableAbortResponse:    true,
        enableExpressPay:       true,
        enableMerTxnDetails:    true,
        siDetailsAtMerchantEnd: true,
        enableSI:               true
      },
      consumerData: {
        deviceId:         'WEBSH2',
        token,
        returnUrl:        window.location.href,
        responseHandler:  handleResponse,
        paymentMode:      'all',
        merchantLogoUrl:  'https://www.paynimo.com/CompanyDocs/company-logo-vertical.png',
        merchantId:       MERCHANT_ID,
        currency:         'INR',
        consumerId,
        consumerMobileNo: fd.mobile,
        consumerEmailId:  fd.email,
        txnId:            tid,
        items:            [{ itemId:'first', amount:'1', comAmt:'0' }],
        accountType:      fd.actype,
        debitStartDate:   fd.start,
        debitEndDate:     fd.end,
        maxAmount:        fd.amount,
        amountType:       fd.amtType,
        frequency:        fd.freq,
        customStyle: {
          PRIMARY_COLOR_CODE:   '#E8762B',
          SECONDARY_COLOR_CODE: '#FFFFFF',
          BUTTON_COLOR_CODE_1:  '#C4581A',
          BUTTON_COLOR_CODE_2:  '#FFFFFF'
        }
      }
    };

    $.pnCheckout(req);

  } catch(err) {
    console.error(err);
    document.getElementById('errMsg').textContent = 'Could not connect to the payment gateway. Please check your internet and try again.';
    setDot(4); show('sError');
  } finally {
    setTimeout(()=>{
      btn.disabled=false; txt.textContent='Authorise with Bank';
      arr.style.display='block'; sp.style.display='none';
    }, 3500);
  }
}

// â”€â”€ HANDLE WORLDLINE RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleResponse(res) {
  setDot(4);
  if(!res?.paymentMethod?.paymentTransaction) {
    document.getElementById('errMsg').textContent = 'No response received from bank gateway. Please try again.';
    return show('sError');
  }
  const txn  = res.paymentMethod.paymentTransaction;
  const code = txn.statusCode;

  if(code==='0300') {
    document.getElementById('mandatePill').textContent = 'Mandate ID: ' + (txn.mandate_reg_no || txn.identifier || 'â€”');
    show('sSuccess');
  } else if(code==='0398') {
    document.getElementById('pendingPill').textContent = 'Txn Ref: ' + (txn.identifier || 'â€”');
    show('sPending');
  } else {
    document.getElementById('errMsg').textContent = txn.errorMessage || txn.statusMessage || 'Registration failed. Please try again.';
    show('sError');
  }
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetAll() {
  fd = {};
  ['fname','fmobile','femail','fcity','fpan','famount','fstart','fend'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
  document.querySelectorAll('.ferr').forEach(e=>e.classList.remove('show'));
  document.querySelectorAll('input,select').forEach(e=>e.classList.remove('err'));
  document.getElementById('phWrap').classList.remove('err');
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('selected'));
  setDot(1); show('s1');
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setDot(1);
document.getElementById('fmobile').addEventListener('input',function(){ this.value=this.value.replace(/\D/g,'').slice(0,10); });
document.getElementById('fpan').addEventListener('input',function(){ this.value=this.value.toUpperCase(); });
document.getElementById('famount').addEventListener('input',function(){
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('selected'));
});
</script>
</body>
</html>
